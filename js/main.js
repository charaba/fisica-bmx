const piecesData = {
  banco: {
    title: "No Banco",
    image: "images/banco.png",
    textTitle: "O Ciclista",
brief: "No centro da pr√°tica do BMX est√° o ciclista, cuja t√©cnica, preparo f√≠sico e entendimento das regras definem o desempenho e a seguran√ßa nas pistas e nas ruas.",
formula: "F = m¬∑a  <br> F - For√ßa Resultante <br> m - Massa <br> a - Acelera√ß√£o",
explication: "Esta se√ß√£o √© dedicada √† figura central do esporte: o ciclista. No BMX, diferentes modalidades ‚Äî como o Street, Park, Flatland e Racing ‚Äî exigem estilos de pilotagem distintos, cada uma com suas pr√≥prias regras e t√©cnicas. O ciclista precisa dominar o equil√≠brio, a impuls√£o e o controle do corpo para executar manobras com precis√£o, respeitando limites de seguran√ßa e regulamenta√ß√µes esportivas.\n\nFisicamente, o BMX demanda for√ßa explosiva, coordena√ß√£o motora e tomada r√°pida de decis√£o. A intera√ß√£o entre corpo e bicicleta √© guiada por princ√≠pios f√≠sicos como o impulso, a conserva√ß√£o do momento angular e o centro de massa. Por exemplo, a forma como o ciclista se inclina antes de um salto pode alterar completamente a trajet√≥ria e a rota√ß√£o da bicicleta. \n\nAl√©m disso, o respeito √†s regras ‚Äî como o uso de equipamentos obrigat√≥rios e conduta esportiva ‚Äî √© fundamental tanto em competi√ß√µes oficiais quanto na pr√°tica recreativa. Este m√≥dulo oferece uma abordagem visual e interativa que revela como o dom√≠nio t√©cnico e a compreens√£o das leis da f√≠sica se unem na performance sobre duas rodas.",
    hasGame: true
  },
  freio: {
    title: "Freio",
    image: "images/freio.png",
    textTitle: "Controle e Atrito",
    brief: "O princ√≠pio central dos freios √© o atrito, que √© a for√ßa que se op√µe ao movimento relativo entre duas superf√≠cies em contato. No caso da bicicleta, quando acionamos o freio, as pastilhas de freio pressionam o aro ou o disco da roda, gerando atrito e diminuindo sua velocidade. Isso ocorre devido √† transforma√ß√£o da energia cin√©tica da bicicleta em energia t√©rmica, dissipada no sistema de frenagem.",
    formula: "Fat = ùúá * N  <br> Fat - √© a for√ßa de atrito que reduz a velocidade da roda <br> ùúá - √© o coeficiente de atrito entre as pastilhas e o disco/aro <br> N - √© a for√ßa perpendicular √† superf√≠cie de contato",
    explication: "No BMX, o freio √© crucial para manobras e controle do ciclista. Em modalidades como BMX Freestyle, o ciclista precisa dos freios para regular sua velocidade e preparar-se para saltos ou aterrissagens seguras. A for√ßa de atrito gerada pelos freios permite uma parada r√°pida, o que √© essencial em terrenos irregulares ou em pistas cheias de obst√°culos. Al√©m disso, o coeficiente de atrito entre os freios e a roda pode influenciar a efici√™ncia da frenagem: freios hidr√°ulicos, por exemplo, t√™m um coeficiente maior, proporcionando uma resposta mais r√°pida."
  },
  guidao: {
    title: "Guid√£o",
    image: "images/guidao.png",
    textTitle: "Momento Angular",
    brief: "O guid√£o da bicicleta est√° diretamente relacionado ao conceito de torque e momento angular. Quando um ciclista aplica uma for√ßa ao guid√£o, ele cria um torque que pode alterar a dire√ß√£o da bicicleta. Al√©m disso, em manobras como giros e saltos, o momento angular entra em jogo, permitindo que o ciclista gire o guid√£o no ar e estabilize sua posi√ß√£o ao aterrissar.",
    formula: "œÑ = F * d <br> œÑ - √© o torque gerado <br> F - √© a for√ßa aplicada no guid√£o <br> d - √© a dist√¢ncia entre o ponto de aplica√ß√£o de for√ßa e o eixo de rota√ß√£o do guid√£o <br><br> L = I * œâ <br> L - √© o momento angular <br> I - √© o momento de in√©rcia do sistema <br> œâ - √© a velocidade angular",
    explication: "No BMX, o guid√£o n√£o serve apenas para direcionar a bicicleta, mas tamb√©m para executar manobras complexas, como o barspin (rota√ß√£o do guid√£o enquanto o ciclista est√° no ar). Quando o ciclista gira o guid√£o, ele aplica torque, gerando um movimento rotacional. Para estabilizar esse movimento, ele pode ajustar sua posi√ß√£o corporal e redistribuir seu peso, influenciando o momento angular. Al√©m disso, o controle da bicicleta em curvas depende da aplica√ß√£o do torque no guid√£o, permitindo mudan√ßas na trajet√≥ria sem comprometer o equil√≠brio."
  },
  quadro: {
    title: "Quadro",
    image: "images/quadro.png",
    textTitle: "Rigidez e Centro de Massa",
    brief: "O quadro da bicicleta est√° diretamente relacionado aos conceitos de rigidez estrutural, centro de massa e distribui√ß√£o de for√ßas. Ele precisa ser leve para facilitar manobras, mas tamb√©m resistente para suportar impactos durante saltos e aterrissagens. Al√©m disso, a posi√ß√£o do centro de massa do ciclista em rela√ß√£o ao quadro influencia diretamente o equil√≠brio e a estabilidade durante a pilotagem.",
    formula: "P = m * g <br> P - √© a for√ßa peso que age sobre o quadro <br> m - √© a massa do conjunto bicicleta + ciclista <br> g - √© a acelera√ß√£o da gravidade",
    explication: "No BMX, o quadro precisa ter um centro de massa bem posicionado para garantir que o ciclista possa executar manobras com controle. Um quadro mais curto permite mais agilidade, enquanto um quadro mais longo aumenta a estabilidade. Durante um salto, a posi√ß√£o do ciclista em rela√ß√£o ao quadro influencia a rota√ß√£o no ar, pois o deslocamento do centro de massa altera o momento angular. Al√©m disso, a rigidez estrutural do quadro garante que ele absorva impactos sem deforma√ß√£o excessiva, distribuindo a for√ßa ao longo da estrutura."
  },
  corrente: {
    title: "Corrente",
    image: "images/corrente.png",
    textTitle: "Transmiss√£o de Energia",
    brief: "No sistema de transmiss√£o da bicicleta, a energia muscular do ciclista √© convertida em energia mec√¢nica atrav√©s dos pedais, corrente, coroa e pinh√£o. Esse processo segue o princ√≠pio da Lei da Conserva√ß√£o da Energia, onde a energia gerada n√£o se perde, mas √© transformada em diferentes formas (cin√©tica, t√©rmica, etc.).",
    formula: "P = F * v <br> P - √© a pot√™ncia mec√¢nica gerada pelo ciclista <br> F - √© a for√ßa aplicada no pedal <br> v - √© a velocidade linear da bicicleta <br><br> Rela√ß√£o das Engrenagens <br> GR = D1 / D2 <br> GR - √© a rela√ß√£o de engrenagens <br> D1 - √© o n√∫mero de dentes da maior engrenagem (coroa) <br> D2 - √© o n√∫mero de dentes da menor engrenagem (pinh√£o) <br> Ex: se a coroa tem 25 dentes e o pinh√£o tem 9, ent√£o: GR = 25 / 9 ‚âà 2.78",
    explication: "No BMX, a rela√ß√£o de engrenagens afeta diretamente a acelera√ß√£o e a velocidade m√°xima. Uma rela√ß√£o maior (coroa com mais dentes) exige mais for√ßa para pedalar, mas gera maior velocidade final. J√° uma rela√ß√£o menor (coroa com menos dentes) facilita arrancadas r√°pidas, ideais para manobras. O ciclista escolhe a rela√ß√£o ideal dependendo do estilo de BMX: no freestyle, rela√ß√µes menores proporcionam mais controle; no race, rela√ß√µes maiores favorecem velocidades altas."
  },
  rodas: {
    title: "Rodas",
    image: "images/rodas.png",
    textTitle: "Atrito e In√©rcia",
    brief: "O atrito desempenha um papel crucial no contato das rodas com o solo. Existem dois tipos principais de atrito no BMX: atrito est√°tico, que impede que a roda deslize quando est√° em movimento, e atrito din√¢mico, que ocorre quando h√° derrapagem. Al√©m disso, a in√©rcia das rodas influencia a acelera√ß√£o e a frenagem, enquanto a for√ßa normal atua perpendicularmente ao solo, influenciando a ader√™ncia.",
    formula: "Fat = ùúá * N <br> Fat - √© a for√ßa de atrito <br> ùúá - √© o coeficiente de atrito entre o pneu e o solo <br> N - √© a for√ßa perpendicular exercida pelo peso da bicicleta e do ciclista <br><br> I = m * r¬≤ <br> I - √© o momento de in√©rcia da roda <br> m - √© a massa da roda <br> r - √© o raio da roda",
    explication: "No BMX, o atrito dos pneus com o solo afeta a ader√™ncia e a manobrabilidade. Pneus com maior superf√≠cie de contato aumentam o atrito, melhorando a estabilidade em curvas e aterrissagens. Em pistas de terra ou rampas, o coeficiente de atrito do solo influencia a tra√ß√£o da bicicleta‚Äîsuperf√≠cies √°speras proporcionam maior ader√™ncia, enquanto superf√≠cies lisas aumentam a velocidade. A in√©rcia das rodas afeta a rapidez com que a bicicleta responde aos movimentos: rodas mais leves giram com menos resist√™ncia, permitindo maior controle sobre saltos e manobras."
  }
};

const modalitiesData = {
  racing: {
    title: "üèÅ Racing",
    image: "images/racing.png",
    description: "O Racing √© uma modalidade de corrida no BMX, onde o primeiro a cruzar a linha de chegada vence. Foi a segunda varia√ß√£o na origem do BMX, transformando o freestyle em uma competi√ß√£o focada em velocidade.",
    equipment: "‚Ä¢ Capacete full face (prote√ß√£o completa, incluindo queixo)\n‚Ä¢ Cal√ßa e blusa de manga comprida\n‚Ä¢ Opcional: sapatilha com clip para fixa√ß√£o no pedal",
    rules: "‚Ä¢ Aplica√ß√£o do fair play padr√£o das corridas\n‚Ä¢ Evitar jogo de corpo com a bicicleta\n‚Ä¢ Na largada, respeitar os sinais sonoros e visuais e aguardar a descida da barreira (gate)",
    competitions: "‚Ä¢ Locais: competi√ß√µes municipais, estaduais e nacionais\n‚Ä¢ Internacionais: Sul-americano, Pan-americano, Campeonato Mundial e Olimp√≠adas\n‚Ä¢ Atletas de destaque: Guilherme Ribeiro; Deivlim (Turbo) Balthazar"
  },
  bowl: {
    title: "ü•£ Bowl",
    image: "images/bowl.png",
    description: "O Bowl pertence ao Freestyle BMX, onde o atleta explora pistas em formato de tigela, combinando fluidez e amplitude em cada transi√ß√£o curva-pared√£o-curva.",
    equipment: "‚Ä¢ Capacete b√°sico ou half-shell\n‚Ä¢ Joelheiras e cotoveleiras para proteger quedas laterais\n‚Ä¢ Luvas para maior ader√™ncia",
    rules: "‚Ä¢ Julgamento baseado em fluidez, amplitude dos voos e criatividade na linha de manobras\n‚Ä¢ Penaliza√ß√µes por desequil√≠brios exagerados ou quedas que interrompam a sequ√™ncia\n‚Ä¢ Tempo limite de apresenta√ß√£o, geralmente 45‚Äì60 s",
    competitions: "‚Ä¢ Vans Pro Series; X Games; BMX Street Session Bowl\n‚Ä¢ Atletas de destaque: Cau√£ Madona (Madona); Paulo Charaba"
  },
  park: {
    title: "üõπ Park",
    image: "images/park.png",
    description: "No Freestyle Park, os obst√°culos (rampas, quarter pipes, spine ramps) s√£o dispostos para criar linhas cont√≠nuas que incentivam combina√ß√£o de manobras r√°pidas e graciosas.",
    equipment: "‚Ä¢ Capacete essencial (half-shell)\n‚Ä¢ Joelheira e cotoveleira\n‚Ä¢ √ìculos de prote√ß√£o em pistas com part√≠culas soltas",
    rules: "‚Ä¢ Cada volta dura cerca de 1 min15 s; s√£o permitidas 2‚Äì3 runs por atleta\n‚Ä¢ Avalia√ß√£o considera amplitude, dificuldade das manobras, fluidez e estilo\n‚Ä¢ Dedu√ß√£o de pontos por interrup√ß√µes ou uso excessivo de um √∫nico obst√°culo",
    competitions: "‚Ä¢ Sul-americano, Pan-americano, Mundial e Olimp√≠adas (Park BMX)\n‚Ä¢ Atletas de destaque: Jos√© Maligno (atual campe√£o ol√≠mpico); Gustavo (BalaLoca); Andr√© Jesus"
  },
  street: {
    title: "üöß street",
    image: "images/street.png",
    description: "No Street, os atletas usam cen√°rios urbanos ‚Äî escadas, corrim√£os, bordas ‚Äî como elementos para criar verdadeiros circuitos de manobras e truques criativos.",
    equipment: "‚Ä¢ Capacete (half-shell ou full face, dependendo do obst√°culo)\n‚Ä¢ Joelheira e cotoveleira\n‚Ä¢ T√™nis de sola r√≠gida para controlar o contato com os pedais",
    rules: "‚Ä¢ Criatividade e diversidade de combos s√£o crit√©rios principais\n‚Ä¢ Uso √©tico do espa√ßo privado; proibi√ß√£o de danos ao patrim√¥nio urbano\n‚Ä¢ Penalidades por manobras que ofere√ßam risco extremo sem controle",
    competitions: "‚Ä¢ X Games Street; FISE World Series; Red Bull District Ride\n‚Ä¢ Atletas de destaque: Mario Chocolate; Kevin Peraza (vencedor do X Games)"
  },
  flatland: {
    title: "üé≠ Flatland",
    image: "images/flatland.png",
    description: "Conhecido como o bal√© sobre duas rodas, o Flatland exige controle de equil√≠brio e precis√£o em manobras est√°ticas e rotacionais, geralmente sem uso de freios.",
    equipment: "‚Ä¢ Quadro customizado sem freio (para fluidez total)\n‚Ä¢ Selim rebaixado e guid√£o gasto abaixo do padr√£o para manobras de p√©s no quadro",
    rules: "‚Ä¢ Proibi√ß√£o de colocar o p√© no ch√£o durante a run\n‚Ä¢ Avalia√ß√£o por originalidade, complexidade e transi√ß√£o entre manobras\n‚Ä¢ Runs de 60‚Äì90 s; at√© 3 runs por atleta",
    competitions: "‚Ä¢ FISE Flatland; Auditorium Flatland Contest; Flatark\n‚Ä¢ Atletas de destaque: Francisco Pekeno; Pedro Nascimento"
  },
  dirt: {
    title: "‚õ∞Ô∏è Dirt Jump",
    image: "images/dirt.png",
    description: "Inspirado no motocross, o Dirt traz rampas de terra de at√© 4 m de altura, saltos longos e aterrissagens t√©cnicas, focando em truques no ar.",
    equipment: "‚Ä¢ Capacete full face\n‚Ä¢ Joelheira, cotoveleira e luvas refor√ßadas\n‚Ä¢ √ìculos de prote√ß√£o contra poeira",
    rules: "‚Ä¢ Pontua√ß√£o baseada em combina√ß√£o de rota√ß√µes, flips e estilo de aterrissagem\n‚Ä¢ Sequ√™ncia de 3‚Äì5 saltos; cada salto avaliado separadamente\n‚Ä¢ Penaliza√ß√µes por quedas ou sa√≠das de linha do circuito",
    competitions: "‚Ä¢ Carapicu√≠ba Monster Jump; Jump Festival; Red Bull Dirt Conquers\n‚Ä¢ Atletas de destaque: Leandro Overall; Mike Moura"
  },
  vert: {
    title: "üìê Vert",
    image: "images/vert.png",
    description: "No Vert, pistas em formato de U (half-pipe) permitem que o atleta ganhe altura para executar manobras a√©reas de grande amplitude.",
    equipment: "‚Ä¢ Capacete full face\n‚Ä¢ Joelheira, cotoveleira e protetores de pulso\n‚Ä¢ Equipamento de corpo (colete leve) em Mega Rampa",
    rules: "‚Ä¢ Julgamento por altura alcan√ßada, amplitude das manobras e qualidade no pouso\n‚Ä¢ Runs de 60 s; at√© 3 runs; o melhor score conta\n‚Ä¢ Dedu√ß√£o por pousos inst√°veis ou perda de controle",
    competitions: "‚Ä¢ X Games Vert; Pr√≥ Rad Brasil; Nitro World Games\n‚Ä¢ Atletas de destaque: Matt Hoffman; Edmilson Pardal; Douglas Leite (Doguete)"
  }
};

const pieceCanvases = {};
const headerPieceName = document.getElementById('header-piece-name');
const pieces = document.querySelectorAll('.piece');

pieces.forEach(piece => {
  piece.style.pointerEvents = 'auto';
  const loadCanvas = () => {
    pieceCanvases[piece.id] = createOffscreenCanvas(piece);
  };
  piece.addEventListener('load', loadCanvas);
  if (piece.complete) loadCanvas();
});

function createOffscreenCanvas(img) {
  const canvas = document.createElement('canvas');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  canvas.getContext('2d').drawImage(img, 0, 0);
  return canvas;
}

function isVisiblePixel(img, canvas, e) {
  if (!canvas) return false;
  const rect = img.getBoundingClientRect();
  const scaleX = img.naturalWidth / rect.width;
  const scaleY = img.naturalHeight / rect.height;
  const x = Math.floor((e.clientX - rect.left) * scaleX);
  const y = Math.floor((e.clientY - rect.top) * scaleY);
  const pixel = canvas.getContext('2d').getImageData(x, y, 1, 1).data;
  return pixel[3] > 0;
}

const container = document.getElementById("bike-container");
let lastHovered = null;

container.addEventListener("mousemove", e => {
  const allPieces = Array.from(pieces).reverse();
  let found = false;
  for (const piece of allPieces) {
    if (isVisiblePixel(piece, pieceCanvases[piece.id], e)) {
      if (lastHovered && lastHovered !== piece) lastHovered.classList.remove('hovered');
      piece.classList.add('hovered');
      const key = piece.getAttribute("data-piece");
      if (piecesData[key]) {
        headerPieceName.textContent = piecesData[key].title;
        headerPieceName.style.opacity = "1";
      }
      lastHovered = piece;
      found = true;
      break;
    }
  }
  if (!found && lastHovered) {
    lastHovered.classList.remove('hovered');
    headerPieceName.style.opacity = "0";
    lastHovered = null;
  }
});

container.addEventListener("mouseleave", () => {
  if (lastHovered) {
    lastHovered.classList.remove('hovered');
    headerPieceName.style.opacity = "0";
    lastHovered = null;
  }
});

container.addEventListener("click", e => {
  const allPieces = Array.from(pieces).reverse();
  for (const piece of allPieces) {
    if (isVisiblePixel(piece, pieceCanvases[piece.id], e)) {
      openDetail(piece.getAttribute("data-piece"), piece);
      break;
    }
  }
});

const detailOverlay = document.getElementById('detail-overlay'),
  detailTitle = document.getElementById('detail-title'),
  detailPieceImg = document.getElementById('detail-piece-img'),
  detailTextTitle = document.getElementById('detail-text-title'),
  detailTextBrief = document.getElementById('detail-text-brief'),
  detailTextFormula = document.getElementById('detail-text-formula'),
  detailTextExplication = document.getElementById('detail-text-explication'),
  backButton = document.getElementById('back-button'),
  startGameBtn = document.getElementById('start-game-btn'),
  goModalidadesBtn = document.getElementById('go-modalidades-btn');

let activePiece = null;

function openDetail(pieceKey, pieceElement) {
  activePiece = pieceKey;
  const data = piecesData[pieceKey];
  
  detailTitle.textContent = data.title;
  detailPieceImg.src = data.image;
  detailPieceImg.alt = data.title;
  detailTextTitle.textContent = data.textTitle;
  detailTextBrief.textContent = data.brief;
  detailTextFormula.innerHTML = data.formula.replace(/\n/g, "<br>");
  detailTextExplication.textContent = data.explication;
  
  startGameBtn.style.display = data.hasGame ? "inline-block" : "none";
  goModalidadesBtn.style.display = (pieceKey === "banco") ? "inline-block" : "none";
  
  detailOverlay.classList.remove('hidden');
  detailOverlay.classList.add('visible');
  
  animatePieceToDetail(pieceElement, () => {
    detailPieceImg.style.visibility = 'visible';
    backButton.style.opacity = '1';
  });
}

function closeDetail() {
  activePiece = null;
  backButton.style.opacity = '0';
  detailOverlay.classList.remove('visible');
  setTimeout(() => detailOverlay.classList.add('hidden'), 500);
}

backButton.addEventListener('click', closeDetail);
document.addEventListener('keydown', e => {
  if (e.key === 'Escape' && detailOverlay.classList.contains('visible')) {
    closeDetail();
  }
});

function animatePieceToDetail(pieceElement, callback) {
  const startRect = pieceElement.getBoundingClientRect(),
        destRect = detailPieceImg.getBoundingClientRect(),
        clone = pieceElement.cloneNode(true);
        
  clone.style.position = 'fixed';
  clone.style.top = startRect.top + 'px';
  clone.style.left = startRect.left + 'px';
  clone.style.width = startRect.width + 'px';
  clone.style.height = startRect.height + 'px';
  clone.style.transition = 'all 0.5s ease';
  clone.style.zIndex = '300';
  
  document.body.appendChild(clone);
  detailPieceImg.style.visibility = 'hidden';
  
  requestAnimationFrame(() => {
    clone.style.top = destRect.top + 'px';
    clone.style.left = destRect.left + 'px';
    clone.style.width = destRect.width + 'px';
    clone.style.height = destRect.height + 'px';
  });
  
  clone.addEventListener('transitionend', () => {
    callback();
    document.body.removeChild(clone);
  }, { once: true });
}

startGameBtn.addEventListener('click', () => {
  closeDetail();
  const minigameOverlay = document.getElementById('minigame-overlay');
  minigameOverlay.classList.add('visible');
  minigameOverlay.classList.remove('hidden');
  if (typeof startSimulation === 'function') {
    startSimulation();
  } else {
    console.error("startSimulation() n√£o est√° definido!");
  }
});

goModalidadesBtn.addEventListener('click', () => {
  closeDetail();
  const bikeContainer = document.getElementById('bike-container');
  bikeContainer.style.transition = "transform 0.8s ease";
  void bikeContainer.offsetWidth;
  bikeContainer.style.transform = "translateX(150%)";
  setTimeout(() => {
    const modalidadesOverlay = document.getElementById('modalidades-overlay');
    modalidadesOverlay.classList.add('visible');
    modalidadesOverlay.classList.remove('hidden');
  }, 800);
});

const modalidadesOverlay = document.getElementById('modalidades-overlay');
const modalidadesBackButton = document.getElementById('modalidades-back-button');

modalidadesBackButton.addEventListener('click', returnFromModalidades);
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    if (modDetailOverlay.classList.contains('visible')) {
      closeModalityDetail();
    } else if (modalidadesOverlay.classList.contains('visible')) {
      returnFromModalidades();
    }
  }
});

const modDetailOverlay = document.getElementById('modality-detail-overlay');
modDetailOverlay.addEventListener('click', e => {
  if(e.target === modDetailOverlay) {
    closeModalityDetail();
  }
});

function returnFromModalidades() {
  const modalidadesOverlay = document.getElementById('modalidades-overlay');
  modalidadesOverlay.classList.remove('visible');
  setTimeout(() => modalidadesOverlay.classList.add('hidden'), 800);

  const bikeContainer = document.getElementById('bike-container');
  bikeContainer.style.transition = "none";
  bikeContainer.style.transform = "translateX(-100%)";
  void bikeContainer.offsetWidth;
  bikeContainer.style.transition = "transform 0.8s ease";
  bikeContainer.style.transform = "translateX(0%)";
}

const cards = document.querySelectorAll("#modalities-carousel .card");
cards.forEach(card => {
  card.addEventListener('click', () => {
    const modalityKey = card.getAttribute('data-modality');
    openModalityDetail(modalityKey);
  });
});

const modDetailBackButton = document.getElementById('mod-detail-back-button'),
      modDetailTitle = document.getElementById('modality-detail-title'),
      modDetailImg = document.getElementById('modality-detail-img'),
      modDetailDescription = document.getElementById('modality-detail-description'),
      modDetailEquipment = document.getElementById('modality-detail-equipment'),
      modDetailRules = document.getElementById('modality-detail-rules'),
      modDetailCompetitions = document.getElementById('modality-detail-competitions');

      function openModalityDetail(modalityKey) {
        const data = modalitiesData[modalityKey];
        if (!data) return;
      
        modDetailTitle.textContent = data.title;
        modDetailImg.src = data.image;
        modDetailImg.alt = data.title;
        modDetailDescription.textContent = data.description;
      
        modDetailEquipment.innerHTML = `<span style="color:#FFA500;font-weight:bold;">üìå Equipamento:</span><br>` +
          data.equipment.replace(/\n/g, "<br>");
      
        modDetailRules.innerHTML = `<span style="color:#FFA500;font-weight:bold;">‚öñÔ∏è Regras:</span><br>` +
          data.rules.replace(/\n/g, "<br>");
      
        modDetailCompetitions.innerHTML = `<span style="color:#FFA500;font-weight:bold;">üèÜ Competi√ß√µes e Atletas:</span><br>` +
          data.competitions
            .replace(/(Locais:|Internacionais:|Atletas de destaque:)/g, `<span style="color:#FFA500;font-weight:bold;">$1</span>`)
            .replace(/\n/g, "<br>");
      
      
        modDetailOverlay.classList.remove('hidden');
        modDetailOverlay.classList.add('visible');
      }

function closeModalityDetail() {
  modDetailOverlay.classList.remove('visible');
  setTimeout(() => modDetailOverlay.classList.add('hidden'), 500);
}

modDetailBackButton.addEventListener('click', closeModalityDetail);

const hoverPhysics = document.getElementById("hover-physics");
const tooltip      = document.getElementById("tooltip");

hoverPhysics.addEventListener("mouseenter", () => {
  tooltip.textContent = "Fernando F√≠sica";
  tooltip.style.display = "block";
});
hoverPhysics.addEventListener("mousemove", e => {
  tooltip.style.left = (e.pageX + 10) + "px";
  tooltip.style.top  = (e.pageY + 10) + "px";
});
hoverPhysics.addEventListener("mouseleave", () => {
  tooltip.style.display = "none";
});

const videoOverlay   = document.getElementById("video-overlay");
const fernandoVideo  = document.getElementById("fernando-video");
let isFirstPlayback  = true;

hoverPhysics.addEventListener("click", () => {
  if (isFirstPlayback) {
    fernandoVideo.src = "images/Fernando.mp4";
    isFirstPlayback = false;
  } else {
    const op√ß√µes = [
      "images/Fernando.mp4",
      "images/Fernando2.mp4",
      "images/Fernando3.mp4"
    ];
    const idx = Math.floor(Math.random() * op√ß√µes.length);
    fernandoVideo.src = op√ß√µes[idx];
  }
  videoOverlay.style.display = "flex";
  fernandoVideo.currentTime = 0;
  fernandoVideo.play();
});

fernandoVideo.addEventListener("ended", () => {
  fernandoVideo.pause();
  videoOverlay.style.display = "none";
});
